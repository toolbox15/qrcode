<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Redirect</title>
</head>
<body style="background: #0f172a; color: white; font-family: sans-serif; text-align: center; padding-top: 50px;">
    
    <div id="loader">
        <h2>Connecting to Review Page...</h2>
        <p>Please wait a moment.</p>
    </div>

    <script>
        const CONFIG = {
            BIN_ID: '6988ac72ae596e708f1ab357',
            API_KEY: '$2a$10$Rs0hwy8AsGdOhHr2VjH3j.voZoeOgcZ1ddCdfzn.63bqiKTGSW1gW'
        };

        async function redirect() {
            // 1. Get the ID from the URL (?id=xxxx)
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            if (!id) {
                document.body.innerHTML = "<h2>Error: No ID found.</h2>";
                return;
            }

            try {
                // 2. Fetch the latest data from your Cloud DB
                const r = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}/latest`, { 
                    headers: { 'X-Master-Key': CONFIG.API_KEY } 
                });
                const d = await r.json();
                const badgeData = d.record.qrs.find(q => q.id === id);

                // 3. Send them to the Google URL saved for that tech
                if (badgeData && badgeData.url) {
                    window.location.href = badgeData.url;
                } else {
                    document.body.innerHTML = "<h2>Error: Review link not found.</h2>";
                }
            } catch (e) {
                console.error(e);
                document.body.innerHTML = "<h2>Connection Error. Please try again.</h2>";
            }
        }

        redirect();
    </script>
</body>
</html>
